sudo: required
language: python

python:
  - "3.6"

addons:
  apt:
    packages:
      - unzip

before_install:
  - sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
  - echo "deb http://download.mono-project.com/repo/ubuntu wheezy/snapshots/4.8.1 main" | sudo tee /etc/apt/sources.list.d/mono-xamarin.list
  - sudo apt-get update
  - sudo apt-get install -y clang
  - sudo apt-get install -y mono-complete

  - sudo wget https://github.com/inkle/ink/releases/download/0.7.4/inklecate_windows_and_linux.zip
  - cd $TRAVIS_BUILD_DIR
  - unzip inklecate_windows_and_linux.zip
  - chmod +x inklecate.exe

install:
  - pip install -U setuptools
  - pip install pycparser
  - pip install codecov
  - pip install pytest pytest-cov pytest-asyncio
  - pip install -e .

script:
  - python -m pytest --cov=./

after_success:
  - codecov

deploy:
  provider: pypi
  user: siku2
  password:
    secure: UehLHIrhxY6obkxZb5j9ynmuhHz56x2WZfiPzBJokr8zd2fBZXxJ/Fd/GPE2U8otr1uLoKV1/9nkpjJ4O3t+BzkUhxHqRoKU7AaPLaQG4js2xKX/UbFbqqs69e0J14C9RT7F7u0xds28XizSMm2JkqJBJMnxlWMFc+dN/xeU3LatsTdpZ2WSFQB+Mybgff6+KFS97d7G93U8cPMmzRGI1pNZYfOQnBRlIBSFxF5hJ4xilUztb8eAgwCA9UCkuX66uGnmFElc1i1RU8PV4TDJ2UHx/TIp2jHRgyvKZ97YzO3J1Qlqcn8k5S9vb43qNfW5tRBAg3UBwU2Zbx7pi7lKNca6pKEuIIL/69FNLkuvGjtTIbfKszypqv/5ilKfA45ryAfSGCcOHI0zCbkw3UIW78w2bk2u86RWwAmB4YPw8WVC/i09sKG//ajar1kS6cXaKsqYNzforhYoHAvzsCTpcsV3bR7x17MU3ATiPvu2YC8Z34mHjRMQsVNrbIcrd7dVxqCvfO9bBMg4+HLY13gOrVTYuGku3Mmtt+hlrqP1+2cggA8dyPL7EfbRBfxoqTBv8gAEXmV9i7PE8/L47EY8Ra5s6Rbk70m/MFJmWc2g5Ip2u+P83JxmOaSkv/QbZ5TEDAd4e5hjrJmz2PZqtcG5HAhWkhqgfB3HsqqvDYg66Mo=
  on:
    tags: true
    branch: master